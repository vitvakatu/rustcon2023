<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>RustCon 2023</title>

		<link rel="stylesheet" href="dist/reset.css">
		<link rel="stylesheet" href="dist/reveal.css">
		<link rel="stylesheet" href="dist/theme/white.css">

		<!-- Theme used for syntax highlighted code -->
		<link rel="stylesheet" href="plugin/highlight/intellij-light.css">

    <style media="screen">
      .photo-container {
        width: 200px;
        height: 200px;
        border-radius: 50%;
        overflow: hidden;
      }
      .photo-container img {
        width: 100%;
        height: 100%;
        max-width: 100%;
        max-height: 100%;
        object-fit: cover;
        margin: 0 auto;
      }
      .blurred {
        filter: blur(10px);
      }
      .greyed-out {
        opacity: 0.5;
      }
      h6 {
        font-size: 0.8em;
      }
      .reveal ul {
        list-style-type: none; /* Remove default markers */
      }

      .reveal ul li:before {
        content: "→"; /* Use the desired marker symbol */
        color: black; /* Customize the marker color */
        margin-right: 0.5em; /* Adjust the spacing between the marker and the content */
      }
    </style>
	</head>
	<body>
		<div class="reveal">
			<div class="slides">
				<section><h1>Как (не) написать фронтенд на Rust</h1></section>
				<section>
          <section>
          <h2>О себе</h2>
          <div style="display: flex">
            <div class="photo-container">
              <img class="photo" src="img/me.jpg" alt="Ilya Bogdanov, in greyscale" />
            </div>
            <div>
              <ul>
                <li>Илья Богданов</li>
                <li>Больше пяти лет пишу на Rust</li>
                <li>Преподаю в <a href="https://otus.ru/lessons/rust-developer">OTUS</a></li>
                <li>Developer @ <a href="https://enso.org">Enso</a></li>
              </ul>
            </div>
          </div>
          </section>
          <section>
            <img src="img/cv.png" />
          </section>
        </section>
				<section>
          <h2>Кто мы и что делаем</h2>
          <h6 class="blurred">Как можно написать фронтенд на Rust?</h6>
          <h6 class="blurred">Как можно не написать фронтенд на Rust?</h6>
          <h6 class="blurred">Конец?</h6>
        </section>
				<section>
          <section>
          <h2>Проблема</h2>
          </section>
          <section>
            <img src="img/table1.png">
          </section>
          <section>
            <img src="img/table2.png">
          </section>
          <section>
            <img src="img/table3.png">
          </section>
        </section>
				<section>
          <h2>Решение</h2>
          <video data-autoplay src="img/demo.mp4"></video>
        </section>
				<section>
          <section>
            <h3>Enso Language</h3>
          </section>
          <section>
            <h3>Текстовое + визуальное представление</h3>
            <img src="img/enso-demo.png" />
          </section>
          <section>
            <h3>Функциональный</h3>
            <img style="object-fit: contain; height: 450px;" src="img/enso-complex.png" />
          </section>
          <section>
            <h3>GraalVM</h3>
            <img style="object-fit: contain; height: 400px;" src="img/graalvm.jpeg" /><br/>
            <small><a href="https://rieckpil.de/whatis-graalvm/">https://rieckpil.de/whatis-graalvm/</a></small>
          </section>
          <section>
            <h3>Polyglot</h3>
            <img style="object-fit: contain; height: 300px;" src="img/enso-polyglot.png" />
            <img style="object-fit: contain; height: 150px;" src="img/enso-polyglot-2.png" />
          </section>
        </section>
				<section>
          <h2>Enso IDE</h2>
          <img style="object-fit: contain; height: 500px;" src="img/enso-ide.png" />
        </section>
				<section>
          <h2>Требования к техническому стеку</h2>
          <ol>
            <li class="fragment">Гибкость и кастомизируемость UI</li>
            <li class="fragment">Производительность</li>
            <li class="fragment">Кроссплатформенность</li>
          </ol>
        </section>
				<section>
          <h6 class="greyed-out">Кто мы и что делаем</h6>
          <h2>Как можно написать фронтенд на Rust?</h2>
          <h6 class="blurred">Как можно не написать фронтенд на Rust?</h6>
          <h6 class="blurred">Конец?</h6>
        </section>
				<section>
          <h2>WebAssembly (WASM)</h2>
          <ul>
            <li class="fragment">Стандарт виртуальной машины и байт-кода к ней</li>
            <li class="fragment">Работает во всех современных браузерах</li>
            <li class="fragment">Быстрый</li>
            <li class="fragment">Безопасный</li>
            <li class="fragment">Нет прямого доступа к ОС и DOM</li>
          </ul>
        </section>
				<section>
          <h2>Rust — самый популярный язык для WASM</h2>
          <img src="img/wasm-languages.png" />
          <small><a href="https://blog.scottlogic.com/2023/10/18/the-state-of-webassembly-2023.html">https://blog.scottlogic.com/2023/10/18/the-state-of-webassembly-2023.html</a></small>
        </section>
				<section>
          <section>
            <h2>DOM</h2>
            <img src="img/dom.png" />
          </section>
          <section>
            <pre><code>
// Get the element with id "myElement"
let element = document.getElementById("myElement");

// Change the text content of the element
element.textContent = "Hello, World!";

// Change the background color of the element
element.style.backgroundColor = "blue";
            </code></pre>
          </section>
          <section>
            <div style="display: flex;justify-content: space-around">
            <img style="max-width: 200px; height: auto; object-fit: contain;"  src="img/react-logo.png" />
            <img style="max-width: 200px; height: auto; object-fit: contain;" src="img/yew-logo.png" />
            </div>
          </section>
        </section>
				<section>
          <h2>Canvas</h2>
          <section>
            <div style="display: flex;">
            <pre><code data-trim style="font-size: 0.5em">
function draw() {
  const canvas = document.getElementById("canvas");
  if (canvas.getContext) {
    const ctx = canvas.getContext("2d");
    ctx.beginPath();
    ctx.arc(75, 75, 50, 0, Math.PI * 2, true); // Outer circle
    ctx.moveTo(110, 75);
    ctx.arc(75, 75, 35, 0, Math.PI, false); // Mouth (clockwise)
    ctx.moveTo(65, 65);
    ctx.arc(60, 65, 5, 0, Math.PI * 2, true); // Left eye
    ctx.moveTo(95, 65);
    ctx.arc(90, 65, 5, 0, Math.PI * 2, true); // Right eye
    ctx.stroke();
  }
}
            </code>
            </pre>
            <img style="object-fit: contain;" src="img/smile.png" />
            </div>
          </section>
        </section>
				<section>
          <section>
            <h2>WebGL <img style="vertical-align: bottom; height: 0.8em; object-fit: contain;" src="img/webgl-logo.png" /></h2>
            <ul>
              <li class="fragment">Огрызок OpenGL ES</li>
              <li class="fragment">Порядком устарел</li>
              <li class="fragment">Шейдеры</li>
            </ul>
          </section>
          <section>
            <img src="img/webgl-pipeline.png" />
          </section>
        </section>
				<section>
          <h2>Архитектура</h2>
          <img style="object-fit: contain; height: 500px;" src="img/architecture.png" />
        </section>
				<section>
          <h2>Парсер</h2>
          <ul>
            <li>Scala → Rust</li>
            <li>100 Мб → 4 Мб</li>
            <li>fn parse(string: &str) -> Result&lt;Ast&gt;</li>
            <li>JNI-обертка для использования в бекенде</li>
          </ul>
        </section>
				<section>EnsoGL</section>
				<section>
          <section>
          <h2>SDF (Signed Distance Function)</h2>
\[
  f(x) = \begin{cases}
  -d(x, \partial \Omega) & \text{if }\, x \in \Omega \\
   d(x, \partial \Omega) & \text{if }\, x \in \Omega^c
  \end{cases}
\]
          </section>
          <section>
            <img src="img/sdf-basic.png" />
          </section>
          <section>
            <div style="display:flex;">
            <pre><code data-trim data-noescape class="language-glsl">
float sdCircle( vec2 p, float r )
{
    return length(p) - r;
}
            </code></pre>
            <img style="object-fit: contain;" src="img/sdf-circle.png" />
            </div>
            <small><a href="https://iquilezles.org/articles/distfunctions2d/">https://iquilezles.org/articles/distfunctions2d/</a></small>
          </section>
          <section>
            <div style="display:flex;">
            <pre><code data-trim data-noescape class="language-glsl">
float sdBox( in vec2 p, in vec2 b )
{
    vec2 d = abs(p)-b;
    return length(max(d,0.0)) + min(max(d.x,d.y),0.0);
}
            </code></pre>
            <img style="object-fit: contain;" src="img/sdf-box.png" />
            </div>
            <small><a href="https://iquilezles.org/articles/distfunctions2d/">https://iquilezles.org/articles/distfunctions2d/</a></small>
          </section>
          <section>
            <div style="display:flex;">
            <pre><code data-trim data-noescape style="font-size: 0.8em;" class="language-glsl">
float sdMoon(vec2 p, float d, float ra, float rb )
{
    p.y = abs(p.y);
    float a = (ra*ra - rb*rb + d*d)/(2.0*d);
    float b = sqrt(max(ra*ra-a*a,0.0));
    if( d*(p.x*b-p.y*a) > d*d*max(b-p.y,0.0) )
          return length(p-vec2(a,b));
    return max( (length(p          )-ra),
               -(length(p-vec2(d,0))-rb));
}
            </code></pre>
            <img style="object-fit: contain;" src="img/sdf-moon.png" />
            </div>
            <small><a href="https://iquilezles.org/articles/distfunctions2d/">https://iquilezles.org/articles/distfunctions2d/</a></small>
          </section>
          <section>
            <img style="object-fit: contain; height: 500px;" src="img/sdf-operations.png" />
          </section>
          <section>
            <img style="object-fit: contain; height: 500px;" src="img/sdf-bool.png" />
          </section>
          <section>
            <video data-autoplay src="img/sdf-demo.webm"></video>
            <small><a href="https://www.shadertoy.com/view/lt3BW2">https://www.shadertoy.com/view/lt3BW2</a></small>
          </section>
          <section>
            <div style="display: flex;">
              <pre><code data-trim data-noescape data-line-numbers="1-16|8,9|10,11|12|13" style="font-size: 0.6em; line-height: 1.8em;" class="language-rust">
/// Local scope section button. A dot inside a circle.
pub mod local_scope(LocalScope) {
    ensogl_core::define_shape! {
        alignment = center;
        (style: Style) {
            let dull_alpha: Var&lt;f32&gt; = style.get_number(dull_color_alpha).into();
            let dull_color = &amp;VIVID_COLOR * &amp;dull_alpha;
            let dot = Circle(3.0.px());
            let dot = dot.fill(VIVID_COLOR.glsl());
            let outer = Circle(8.0.px()) - Circle(5.0.px());
            let outer = outer.fill(dull_color.glsl());
            let shape = outer + dot;
            shape.into()
        }
    }
}
              </code></pre>
              <img style="object-fit: contain; height: 300px;" src="img/icon-simple.png" />
            </div>
          </section>
          <section>
            <div style="display: flex;">
              <pre><code data-trim data-noescape style="font-size: 0.4em; line-height: 1.2em;" class="language-rust">
/// A road cone.
pub mod unstable(Unsable) {
    ensogl_core::define_shape! {
        alignment = center;
        (style: Style) {
            let x_radius = 8.0;
            let y_radius = x_radius * 0.465;
            let bottom = Ellipse(x_radius.px(), y_radius.px());
            let bottom_pos_y = -SIZE / 2.0 + y_radius;
            let bottom = bottom.translate_y(bottom_pos_y.px());
            let bottom_center = Ellipse(5.0.px(), 2.0.px()).translate_y((-3.0).px());
            let height = 12.5;
            let y_offset = height / 2.0 - 3.0;
            let bottom_triangle = Triangle(10.0.px(), height.px()).translate_y(y_offset.px());
            let bottom_mask = bottom_center + bottom_triangle;
            let bottom = bottom - bottom_mask;

            let x_radius = 4.0;
            let y_radius = 1.5;
            let middle = Ellipse(x_radius.px(), y_radius.px());
            let middle_pos_y = -0.5;
            let middle = middle.translate_y(middle_pos_y.px());
            let height = 10.0;
            let y_offset = middle_pos_y + height / 2.0;
            let middle_triangle = Triangle(8.0.px(), height.px()).translate_y(y_offset.px());
            let middle = middle + middle_triangle;
            let mask_y = middle_pos_y + 2.5;
            let mask = HalfPlane().translate_y(mask_y.px());
            let mask_ellipse = Ellipse(3.0.px(), 1.0.px()).translate_y(mask_y.px());
            let mask = mask + mask_ellipse;
            let middle = middle - mask;

            let height = 5.5;
            let top_pos_y = middle_pos_y + 4.5;
            let y_offset = top_pos_y + height / 2.0;
            let top_triangle = Triangle(4.4.px(), height.px()).translate_y(y_offset.px());
            let triangle_mask = HalfPlane().translate_y((SIZE / 2.0 - 1.0).px());
            let top_triangle = top_triangle - triangle_mask;
            let top_ellipse = Ellipse(2.2.px(), 0.4.px()).translate_y(top_pos_y.px());
            let top = top_triangle + top_ellipse;

            let shape = bottom + middle + top;
            let shape = shape.fill(VIVID_COLOR.glsl());
            shape.into()
        }
    }
}
              </code></pre>
              <img style="object-fit: contain; height: 300px;" src="img/icon-complex.png" />
            </div>
          </section>
          <section>
            <pre><code data-trim style="font-size: 0.5em;line-height: 1.8em;" class="language-glsl">
// A lot of lines of code…
bool _3286 = mod(input_local.x, input_size.x * 0.5) < (input_size.x * 0.25);
bool _3294 = mod(input_local.y, input_size.y * 0.5) < (input_size.y * 0.25);
bool _3298 = _3286 || _3294;
bool _3305;
if (_3298)
{
    _3305 = !(_3286 && _3294);
}
else
{
    _3305 = _3298;
}
output_color = mix(vec4(0.0, 0.0, 0.0, 1.0), vec4(1.0, 0.0, 0.0, 1.0), bvec4(_3305));
            </code></pre>
          </section>
        </section>
				<section>
          <section>
            <h2>FRP</h2>
            <h3>(Functional Reactive Programming)</h3>
          </section>
          <section>
            <pre><code data-trim data-noescape class="language-rust">
ensogl_core::define_endpoints! {
    Input {
        set_size (Vector2),
        mouse_nearby (bool),
        click (),
    }
    Output {
        clicked (),
        is_hovered (bool),
        state (State),
        size (Vector2),
    }
}
            </code></pre>
          </section>
          <section>
            <pre><code data-trim data-noescape data-line-numbers="1-8|4,5|6|7" class="language-rust" style="font-size: 0.7em; line-height: 1.4em;">
// === Remove node ===

frp::extend! { network
    all_nodes <= inputs.remove_all_nodes.map(f_!(model.nodes.keys()));
    selected_nodes <= inputs.remove_selected_nodes.map(f_!(model.nodes.all_selected()));
    nodes_remove <- any (all_nodes, selected_nodes);
    out.node_removed <+ nodes_to_remove;
}
            </code></pre>
          </section>
        </section>
				<section>
          <h6 class="greyed-out">Кто мы и что делаем</h6>
          <h6 class="greyed-out">Как можно написать фронтенд на Rust?</h6>
          <h2>Как можно не написать фронтенд на Rust?</h2>
          <h6 class="blurred">Конец?</h6>
        </section>
				<section>
          <section>
            <h2>Многословность</h2>
          </section>
          <section>
            <pre><code data-trim data-noescape class="language-js">
document.getElementById("mousemoveme").onmousemove = (e) => {
    var rect = e.target.getBoundingClientRect();
    var x = e.clientX - rect.left;
    var y = e.clientY - rect.top;
    console.log(`Mouse position: (${x}, ${y})`);
}
            </code></pre>
          </section>
          <section>
            <pre><code data-trim data-noescape style="font-size: 0.9em;" class="language-rust">
use wasm_bindgen::{prelude::*, JsCast};
use web_sys::{console, Document, HtmlElement, MouseEvent};

let mousemove = Closure::&lt;dyn Fn(MouseEvent)&gt;::wrap(Box::new(|e| {
    let rect = e
        .target()
        .expect("mouse event doesn’t have a target")
        .dyn_into::&lt;HtmlElement&gt;()
        .expect("event target should be of type HtmlElement")
        .get_bounding_client_rect();
    let x = (e.client_x() as f64) - rect.left();
    let y = (e.client_y() as f64) - rect.top();
    console::log_1(&amp;format!("Left: {x}, Top: {y}"));
}));
            </code></pre>
          </section>
        </section>
				<section>
          <h2>Пересборка</h2>
          <ul>
            <li class="fragment">20–30 секунд на каждую пересборку</li>
            <li class="fragment">Демо-сцены</li>
          </ul>
          <pre class="fragment"><code class="language-bash">./run gui watch --crate-path=app/gui/demo/icons</code></pre>
        </section>
				<section>
          <h2>Отладка</h2>
        </section>
				<section>
          <h2>Процесс починки бага</h2>
          <ol>
            <li class="fragment">Учишься воспроизводить</li>
            <li class="fragment">Изучаешь исходники и думаешь</li>
            <li class="fragment">Если не придумал, добавляешь везде <span style="font: (--r-code-font);">debug!()</span></li>
            <li class="fragment">…</li>
            <li class="fragment">PROFIT</li>
          </ol>
        </section>
				<section>
          <h2>Тестирование</h2>
        </section>
				<section>
          <h2>«Война за производительность»</h2>
          <ul>
            <li class="fragment">Прекомпиляция шейдеров</li>
            <li class="fragment">Инструментарий для профилирования</li>
            <li class="fragment">Меньше слоёв → меньше draw calls</li>
            <li class="fragment">Кэширование SDF-фигур в текстуру</li>
            <li class="fragment">Magic Rectangle</li>
            <li class="fragment">Оптимизации HTML</li>
          </ul>
        </section>
				<section>
          <h2>Слишком долго</h2>
          <ul>
            <li class="fragment">Разработка новых фичей и исправление багов занимает слишком много времени</li>
            <li class="fragment">Мы утопаем в низкоуровневых багах</li>
            <li class="fragment">Мы вынуждены реализовывать многие вещи с нуля</li>
          </ul>
        </section>
				<section>
          <h6 class="greyed-out">Кто мы и что делаем</h6>
          <h6 class="greyed-out">Как можно написать фронтенд на Rust?</h6>
          <h6 class="greyed-out">Как можно не написать фронтенд на Rust?</h6>
          <h2>Конец?</h2>
        </section>
				<section>
          <section>
            <h2>Текущий статус</h2>
            <img src="img/current-status.png" />
          </section>
          <section>
            <video data-autoplay src="img/demo-new-ide.mp4">
          </section>
        </section>
				<section>
          <h2>Выводы</h2>
          <ul>
          <li class="fragment">У каждого инструмента есть сильные и слабые стороны</li>
          <li class="fragment">Трезво оценивайте свои возможности</li>
          </ul>
        </section>
				<section>
          <h2>Спасибо за внимание</h2>
          <p>Слайды: <a href="https://github.com/vitvakatu/rustcon2023">vitvakatu/rustcon2023</a></p>
          <p>Мой Telegram: <a href="https://t.me/vitvakatu">@vitvakatu</a></p>
          <br/>
          <p>Наш сайт: <a href="https://enso.org">Enso.org</a></p>
          <p>Наш GitHub: <a href="https://github.com/enso-org/enso">enso-org/enso</a></p>
        </section>
			</div>
		</div>

		<script src="dist/reveal.js"></script>
		<script src="plugin/notes/notes.js"></script>
		<script src="plugin/markdown/markdown.js"></script>
		<script src="plugin/highlight/highlight.js"></script>
    <script src="plugin/math/math.js"></script>
		<script>
			// More info about initialization & config:
			// - https://revealjs.com/initialization/
			// - https://revealjs.com/config/
			Reveal.initialize({
				hash: true,
        progress: true,
        slideNumber: 'c/t',
        navigationMode: 'linear',

				// Learn about plugins: https://revealjs.com/plugins/
				plugins: [ RevealMarkdown, RevealHighlight, RevealNotes, RevealMath.KaTeX ]
			});
		</script>
	</body>
</html>
